<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IRMAS Absensi | Sistem Lengkap + TTD + Real-time Update</title>

    <!-- Font & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary: #4361ee;
        --primary-dark: #3a0ca3;
        --secondary: #7209b7;
        --success: #4cc9f0;
        --danger: #f72585;
        --warning: #f8961e;
        --light: #f8f9fa;
        --dark: #212529;
        --gray: #6c757d;
        --light-gray: #e9ecef;
        --border-radius: 12px;
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      body {
        font-family: "Poppins", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: var(--dark);
      }

      #app {
        min-height: 100vh;
      }

      /* ===== LOGIN PAGE ===== */
      .login-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        position: relative;
        overflow: hidden;
      }

      .login-container::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 1px,
          transparent 1px
        );
        background-size: 50px 50px;
        animation: float 20s linear infinite;
      }

      @keyframes float {
        0% {
          transform: translate(0, 0) rotate(0deg);
        }
        100% {
          transform: translate(-50px, -50px) rotate(360deg);
        }
      }

      .login-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 40px;
        width: 100%;
        max-width: 400px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        position: relative;
        z-index: 1;
        animation: slideUp 0.6s ease;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .login-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .login-logo {
        font-size: 48px;
        color: var(--primary);
        margin-bottom: 15px;
        display: inline-block;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .login-title {
        font-size: 24px;
        font-weight: 700;
        color: var(--dark);
        margin-bottom: 5px;
      }

      .login-subtitle {
        font-size: 14px;
        color: var(--gray);
        opacity: 0.8;
      }

      .input-group {
        margin-bottom: 20px;
      }

      .input-group label {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
        color: var(--dark);
        font-weight: 500;
        font-size: 14px;
      }

      .input-group input,
      .input-group textarea,
      .input-group select {
        width: 100%;
        padding: 14px 16px;
        border: 2px solid var(--light-gray);
        border-radius: var(--border-radius);
        font-size: 16px;
        transition: var(--transition);
        background: white;
        font-family: "Poppins", sans-serif;
      }

      .input-group input:focus,
      .input-group textarea:focus,
      .input-group select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
      }

      .input-group textarea {
        min-height: 100px;
        resize: vertical;
        line-height: 1.5;
      }

      .password-container {
        position: relative;
      }

      .toggle-password {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: var(--gray);
        cursor: pointer;
        font-size: 18px;
      }

      .login-btn {
        width: 100%;
        padding: 16px;
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        color: white;
        border: none;
        border-radius: var(--border-radius);
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        transition: var(--transition);
        margin-top: 10px;
      }

      .login-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(67, 97, 238, 0.3);
      }

      .login-footer {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid var(--light-gray);
      }

      .features {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin: 20px 0;
      }

      .feature {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: var(--gray);
      }

      .feature i {
        color: var(--primary);
      }

      .dev-info {
        font-size: 12px;
        color: var(--gray);
        opacity: 0.7;
      }

      /* ===== DASHBOARD ===== */
      .dashboard {
        min-height: 100vh;
        background: var(--light);
      }

      /* Navbar */
      .navbar {
        background: white;
        padding: 0 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      .nav-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 70px;
      }

      .nav-brand {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .nav-brand i {
        font-size: 28px;
        color: var(--primary);
      }

      .nav-brand h1 {
        font-size: 20px;
        font-weight: 700;
        color: var(--dark);
        margin: 0;
      }

      .nav-stats {
        display: flex;
        gap: 15px;
        align-items: center;
      }

      .stat-badge {
        background: var(--light);
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        color: var(--primary);
        display: flex;
        align-items: center;
        gap: 5px;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(67, 97, 238, 0.4);
        }
        70% {
          box-shadow: 0 0 0 6px rgba(67, 97, 238, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(67, 97, 238, 0);
        }
      }

      .hamburger-btn {
        background: none;
        border: none;
        font-size: 24px;
        color: var(--dark);
        cursor: pointer;
        padding: 10px;
        border-radius: 8px;
        transition: var(--transition);
      }

      .hamburger-btn:hover {
        background: var(--light-gray);
      }

      /* Sidebar */
      .sidebar {
        position: fixed;
        top: 70px;
        left: -300px;
        width: 280px;
        height: calc(100vh - 70px);
        background: white;
        box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
        transition: var(--transition);
        z-index: 999;
        overflow-y: auto;
      }

      .sidebar.active {
        left: 0;
      }

      .sidebar-overlay {
        position: fixed;
        top: 70px;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 998;
        display: none;
      }

      .sidebar-overlay.active {
        display: block;
      }

      .sidebar-header {
        padding: 25px 20px;
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        color: white;
      }

      .sidebar-user {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .user-avatar {
        width: 50px;
        height: 50px;
        background: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: var(--primary);
      }

      .user-info h3 {
        font-size: 16px;
        margin-bottom: 5px;
      }

      .user-info p {
        font-size: 13px;
        opacity: 0.9;
      }

      .sidebar-menu {
        padding: 20px 0;
      }

      .menu-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px 25px;
        color: var(--dark);
        text-decoration: none;
        transition: var(--transition);
        border-left: 4px solid transparent;
        cursor: pointer;
      }

      .menu-item:hover {
        background: var(--light-gray);
        color: var(--primary);
      }

      .menu-item.active {
        background: rgba(67, 97, 238, 0.1);
        color: var(--primary);
        border-left-color: var(--primary);
      }

      .menu-item i {
        font-size: 18px;
        width: 24px;
        text-align: center;
      }

      /* Main Content */
      .main-content {
        padding: 25px;
        max-width: 1400px;
        margin: 0 auto;
      }

      /* Welcome Card */
      .welcome-card {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 25px;
        border-radius: 20px;
        margin-bottom: 30px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 20px;
        flex-wrap: wrap;
        animation: slideIn 0.5s ease;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .welcome-text h2 {
        font-size: 24px;
        margin-bottom: 10px;
      }

      .welcome-text p {
        opacity: 0.9;
        font-size: 14px;
      }

      .date-info {
        text-align: center;
        padding: 15px 25px;
        background: rgba(255, 255, 255, 0.15);
        border-radius: var(--border-radius);
        backdrop-filter: blur(10px);
      }

      .date-info .time {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 5px;
      }

      .date-info .date {
        font-size: 14px;
        opacity: 0.9;
      }

      /* Mode Selector */
      .mode-selector {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        background: white;
        padding: 10px;
        border-radius: var(--border-radius);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      .mode-btn {
        flex: 1;
        padding: 15px;
        border: 2px solid var(--light-gray);
        background: white;
        border-radius: var(--border-radius);
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        transition: var(--transition);
        font-size: 15px;
      }

      .mode-btn:hover {
        border-color: var(--primary);
        transform: translateY(-2px);
      }

      .mode-btn.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
      }

      /* Content Sections */
      .content-section {
        display: none;
        animation: fadeIn 0.5s ease;
      }

      .content-section.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Form Cards */
      .form-card {
        background: white;
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        transition: var(--transition);
      }

      .form-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .form-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--light-gray);
      }

      .form-header i {
        font-size: 24px;
        color: var(--primary);
      }

      .form-header h3 {
        font-size: 20px;
        color: var(--dark);
        margin: 0;
      }

      /* Mode Sections */
      .mode-section {
        display: none;
      }

      .mode-section.active {
        display: block;
      }

      /* Divisi Grid */
      .divisi-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 12px;
        margin-top: 10px;
      }

      .divisi-option {
        padding: 16px;
        border: 2px solid var(--light-gray);
        border-radius: var(--border-radius);
        text-align: center;
        cursor: pointer;
        transition: var(--transition);
        background: white;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
      }

      .divisi-option:hover {
        border-color: var(--primary);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(67, 97, 238, 0.1);
      }

      .divisi-option.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
      }

      .divisi-option i {
        font-size: 24px;
        margin-bottom: 5px;
      }

      .divisi-option span {
        font-size: 14px;
        font-weight: 500;
      }

      /* Action Buttons */
      .action-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 30px;
      }

      .action-btn {
        padding: 16px 20px;
        border: none;
        border-radius: var(--border-radius);
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        transition: var(--transition);
        min-height: 54px;
      }

      .action-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
      }

      .action-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
        box-shadow: none !important;
      }

      .btn-individual {
        background: linear-gradient(135deg, #2196f3, #1976d2);
        color: white;
      }

      .btn-group {
        background: linear-gradient(135deg, #9c27b0, #7b1fa2);
        color: white;
      }

      .btn-pdf {
        background: linear-gradient(135deg, #ff6b6b, #f44336);
        color: white;
      }

      .btn-whatsapp {
        background: linear-gradient(135deg, #4caf50, #388e3c);
        color: white;
      }

      .btn-report {
        background: linear-gradient(135deg, #ff9800, #f57c00);
        color: white;
      }

      .btn-danger {
        background: linear-gradient(135deg, #f44336, #d32f2f);
        color: white;
      }

      /* Peserta Management */
      .peserta-section {
        margin-top: 25px;
      }

      .section-title {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
        color: var(--dark);
        font-size: 16px;
        font-weight: 600;
      }

      .peserta-list {
        max-height: 300px;
        overflow-y: auto;
        margin: 15px 0;
        padding: 10px;
        background: var(--light);
        border-radius: var(--border-radius);
        border: 2px dashed var(--light-gray);
      }

      .peserta-item {
        padding: 15px;
        background: white;
        border-radius: var(--border-radius);
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-left: 4px solid var(--primary);
        transition: var(--transition);
      }

      .peserta-item:hover {
        transform: translateX(5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .peserta-info h4 {
        margin-bottom: 5px;
        color: var(--dark);
        font-size: 15px;
      }

      .peserta-info small {
        color: var(--gray);
        font-size: 13px;
      }

      .peserta-actions {
        display: flex;
        gap: 8px;
      }

      .action-small {
        padding: 8px 12px;
        border: none;
        border-radius: 8px;
        font-size: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: var(--transition);
      }

      .btn-success-sm {
        background: var(--success);
        color: white;
      }

      .btn-success-sm:hover {
        background: #00b4d8;
        transform: translateY(-2px);
      }

      .btn-danger-sm {
        background: var(--danger);
        color: white;
      }

      .btn-danger-sm:hover {
        background: #d90429;
        transform: translateY(-2px);
      }

      /* Preview Card */
      .preview-card {
        background: var(--light);
        border: 2px dashed #dee2e6;
        border-radius: var(--border-radius);
        padding: 25px;
        margin-top: 30px;
      }

      .preview-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 20px;
      }

      .preview-header i {
        color: var(--primary);
        font-size: 20px;
      }

      .preview-content {
        background: white;
        padding: 20px;
        border-radius: 10px;
        font-family: "Courier New", monospace;
        font-size: 14px;
        line-height: 1.6;
        white-space: pre-wrap;
        max-height: 250px;
        overflow-y: auto;
        border: 1px solid var(--light-gray);
      }

      /* Chart Container */
      .chart-container {
        background: white;
        border-radius: var(--border-radius);
        padding: 25px;
        margin-bottom: 30px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        height: 400px;
        position: relative;
      }

      .chart-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
      }

      .chart-header h3 {
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--dark);
        font-size: 18px;
      }

      .chart-wrapper {
        height: 300px;
        position: relative;
      }

      /* Ranking Divisi */
      .ranking-container {
        background: white;
        border-radius: var(--border-radius);
        padding: 25px;
        margin-bottom: 30px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
      }

      .ranking-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
      }

      .ranking-header h3 {
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--dark);
        font-size: 18px;
      }

      .ranking-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .ranking-item {
        display: flex;
        align-items: center;
        padding: 15px;
        background: var(--light);
        border-radius: var(--border-radius);
        transition: var(--transition);
      }

      .ranking-item:hover {
        transform: translateX(5px);
        background: #f0f4ff;
      }

      .rank-number {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 18px;
        margin-right: 15px;
      }

      .rank-info {
        flex: 1;
      }

      .rank-info h4 {
        font-size: 16px;
        margin-bottom: 5px;
        color: var(--dark);
      }

      .rank-stats {
        display: flex;
        align-items: center;
        gap: 15px;
        font-size: 13px;
        color: var(--gray);
      }

      .rank-bar {
        flex: 1;
        height: 8px;
        background: var(--light-gray);
        border-radius: 4px;
        overflow: hidden;
      }

      .rank-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        border-radius: 4px;
        transition: width 1s ease;
      }

      /* Table Styles */
      .data-table-container {
        overflow-x: auto;
        margin-top: 20px;
        border-radius: var(--border-radius);
        border: 1px solid var(--light-gray);
        background: white;
      }

      .data-table {
        width: 100%;
        border-collapse: collapse;
        min-width: 800px;
      }

      .data-table th {
        background: var(--primary);
        color: white;
        padding: 15px;
        text-align: left;
        font-weight: 600;
        font-size: 14px;
        position: sticky;
        top: 0;
      }

      .data-table td {
        padding: 15px;
        border-bottom: 1px solid var(--light-gray);
        font-size: 14px;
        transition: var(--transition);
      }

      .data-table tr:last-child td {
        border-bottom: none;
      }

      .data-table tr:hover td {
        background: var(--light);
        transform: scale(1.01);
      }

      .badge {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        display: inline-block;
        transition: var(--transition);
      }

      .badge-individual {
        background: rgba(33, 150, 243, 0.1);
        color: #2196f3;
      }

      .badge-group {
        background: rgba(156, 39, 176, 0.1);
        color: #9c27b0;
      }

      /* Stats Grid */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        padding: 25px;
        border-radius: var(--border-radius);
        text-align: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
      }

      .stat-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 15px;
        color: white;
        font-size: 24px;
        transition: var(--transition);
      }

      .stat-card:hover .stat-icon {
        transform: rotate(360deg) scale(1.1);
      }

      .stat-number {
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 5px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        transition: var(--transition);
      }

      .stat-label {
        color: var(--gray);
        font-size: 14px;
      }

      /* Quick Add Form */
      .quick-add-form {
        background: var(--light);
        padding: 20px;
        border-radius: var(--border-radius);
        margin-bottom: 20px;
        border: 2px solid transparent;
        transition: var(--transition);
      }

      .quick-add-form:focus-within {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
      }

      .quick-add-grid {
        display: grid;
        grid-template-columns: 2fr 1fr auto;
        gap: 10px;
        align-items: end;
      }

      /* Toast Notification */
      .toast {
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        padding: 15px 25px;
        border-radius: var(--border-radius);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        z-index: 9999;
        animation: slideInRight 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
        border-left: 4px solid var(--primary);
        max-width: 350px;
      }

      .toast-success {
        border-left-color: #4caf50;
      }

      .toast-error {
        border-left-color: #f44336;
      }

      .toast-warning {
        border-left-color: #ff9800;
      }

      @keyframes slideInRight {
        from {
          opacity: 0;
          transform: translateX(100%);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--gray);
      }

      .empty-state i {
        font-size: 48px;
        margin-bottom: 15px;
        opacity: 0.5;
      }

      .empty-state p {
        font-size: 16px;
        margin-bottom: 10px;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .login-card {
          padding: 30px 20px;
        }
        .welcome-card {
          flex-direction: column;
          text-align: center;
        }
        .mode-selector {
          flex-direction: column;
        }
        .divisi-grid {
          grid-template-columns: repeat(2, 1fr);
        }
        .action-buttons {
          grid-template-columns: 1fr;
        }
        .main-content {
          padding: 15px;
        }
        .form-card {
          padding: 20px;
        }
        .stats-grid {
          grid-template-columns: 1fr 1fr;
        }
        .quick-add-grid {
          grid-template-columns: 1fr;
        }
        .data-table {
          min-width: 600px;
        }
        .nav-stats {
          display: none;
        }
        .chart-container {
          height: 350px;
        }
        .chart-wrapper {
          height: 250px;
        }
      }

      @media (max-width: 480px) {
        .divisi-grid {
          grid-template-columns: 1fr;
        }
        .stats-grid {
          grid-template-columns: 1fr;
        }
        .nav-brand h1 {
          font-size: 18px;
        }
        .sidebar {
          width: 100%;
          left: -100%;
        }
        .chart-container {
          height: 300px;
        }
        .chart-wrapper {
          height: 200px;
        }
      }
    </style>
  </head>
  <body>
    <div id="app"></div>

    <script>
      // ============================================
      // KONFIGURASI & STATE
      // ============================================
      const CONFIG = {
        WHATSAPP_NUMBER: "+6289657751448",
        DIVISI_LIST: [
          "Keagamaan",
          "Humas",
          "Sekretariat",
          "Pubdekdok",
          "PHBI",
          "PSDM",
          "BPH",
        ],
        ORGANIZATION: {
          KETUA_UMUM: "Agung Ubaidillah",
          SEKRETARIS: "Tasya Amelia Putri",
          WAKIL_KETUA: "Muhammad Arif",
          BENDAHARA: "Siti Fatimah",
        },
        get ABSENSI_DATA() {
          return JSON.parse(localStorage.getItem("irmas_absensi_data") || "[]");
        },
        get PESERTA_LIST() {
          return JSON.parse(localStorage.getItem("irmas_peserta_list") || "[]");
        },
      };

      // Global state
      let currentMode = "individual";
      let currentDivisi = CONFIG.DIVISI_LIST[0];
      let pesertaAbsen = [];
      let activeSection = "dashboard";
      let divisiChart = null;

      // ============================================
      // HELPER FUNCTIONS
      // ============================================
      function showToast(message, type = "info") {
        const existingToast = document.querySelector(".toast");
        if (existingToast) existingToast.remove();

        const toast = document.createElement("div");
        toast.className = `toast toast-${type}`;
        toast.innerHTML = `
                <i class="fas fa-${type === "success" ? "check-circle" : type === "error" ? "exclamation-circle" : "info-circle"}"></i>
                <span>${message}</span>
            `;
        document.body.appendChild(toast);

        setTimeout(() => toast.remove(), 3000);
      }

      function formatDate(date = new Date()) {
        return date.toLocaleDateString("id-ID", {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      }

      function formatTime(date = new Date()) {
        return date.toLocaleTimeString("id-ID", {
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        });
      }

      function getDivisiIcon(divisi) {
        const icons = {
          Keagamaan: "fa-mosque",
          Humas: "fa-bullhorn",
          Sekretariat: "fa-clipboard-list",
          Pubdekdok: "fa-camera",
          PHBI: "fa-calendar-alt",
          PSDM: "fa-user-graduate",
          BPH: "fa-crown",
        };
        return icons[divisi] || "fa-users";
      }

      // ============================================
      // FUNGSI UTAMA UNTUK SIMPAN DATA & UPDATE REAL-TIME
      // ============================================
      function saveAbsensiData(data) {
        const currentData = CONFIG.ABSENSI_DATA;
        currentData.push(data);
        localStorage.setItem("irmas_absensi_data", JSON.stringify(currentData));

        // Update semua tampilan secara real-time
        updateAllDisplays();

        // Animasikan update statistik
        animateStatUpdate();

        showToast("Data berhasil disimpan!", "success");
      }

      function updateAllDisplays() {
        updateStats();
        updateDataTable();
        updateFullDataTable();
        updatePesertaList();
        updatePesertaAbsenList();
        updateDivisiChart();
        updateRankingList();
        updateNavStats();
      }

      function animateStatUpdate() {
        // Animasi untuk stat card
        const statCards = document.querySelectorAll(".stat-card");
        statCards.forEach((card) => {
          card.style.transform = "scale(1.05)";
          card.style.boxShadow = "0 10px 25px rgba(0,0,0,0.2)";

          setTimeout(() => {
            card.style.transform = "";
            card.style.boxShadow = "";
          }, 300);
        });
      }

      function updateNavStats() {
        const { ranking } = calculateDivisiStats();
        const navStats = document.getElementById("navStats");

        if (navStats) {
          navStats.innerHTML = `
                    <span class="stat-badge">
                        <i class="fas fa-trophy"></i>
                        Top: ${ranking.length > 0 ? ranking[0].divisi : "-"}
                    </span>
                    <span class="stat-badge" style="background: #4cc9f0; color: white;">
                        <i class="fas fa-users"></i>
                        ${CONFIG.ABSENSI_DATA.length} Data
                    </span>
                `;
        }
      }

      // ============================================
      // STATISTIK DAN RANKING DIVISI
      // ============================================
      function calculateDivisiStats() {
        const data = CONFIG.ABSENSI_DATA;
        const stats = {};

        // Inisialisasi semua divisi
        CONFIG.DIVISI_LIST.forEach((divisi) => {
          stats[divisi] = {
            total: 0,
            individual: 0,
            group: 0,
            participants: new Set(),
            today: 0,
          };
        });

        // Hitung statistik
        const today = new Date().toDateString();
        data.forEach((item) => {
          if (stats[item.divisi]) {
            stats[item.divisi].total++;

            if (new Date(item.timestamp).toDateString() === today) {
              stats[item.divisi].today++;
            }

            if (item.mode === "individual") {
              stats[item.divisi].individual++;
            } else {
              stats[item.divisi].group++;
            }
            stats[item.divisi].participants.add(item.nama);
          }
        });

        // Buat array untuk sorting
        const ranking = Object.entries(stats).map(([divisi, data]) => ({
          divisi,
          total: data.total,
          individual: data.individual,
          group: data.group,
          today: data.today,
          uniqueParticipants: data.participants.size,
        }));

        // Urutkan dari terbanyak ke tersedikit
        ranking.sort((a, b) => b.total - a.total);

        return { stats, ranking };
      }

      function updateDivisiChart() {
        const { ranking } = calculateDivisiStats();
        const ctx = document.getElementById("divisiChart");

        if (!ctx) return;

        // Destroy chart sebelumnya jika ada
        if (divisiChart) {
          divisiChart.destroy();
        }

        const labels = ranking.map((item) => item.divisi);
        const data = ranking.map((item) => item.total);
        const todayData = ranking.map((item) => item.today);
        const colors = generateChartColors(labels.length);

        divisiChart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Total Absensi",
                data: data,
                backgroundColor: colors,
                borderColor: colors.map((color) => color.replace("0.8", "1")),
                borderWidth: 2,
                borderRadius: 8,
                borderSkipped: false,
              },
              {
                label: "Hari Ini",
                data: todayData,
                backgroundColor: colors.map((color) =>
                  color.replace("0.8", "0.4"),
                ),
                borderColor: colors.map((color) => color.replace("0.8", "1")),
                borderWidth: 1,
                borderRadius: 4,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: "top",
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    const divisi = ranking[context.dataIndex];
                    if (context.datasetIndex === 0) {
                      return [
                        `Total: ${divisi.total} absensi`,
                        `Individual: ${divisi.individual}`,
                        `Grup: ${divisi.group}`,
                        `Peserta Unik: ${divisi.uniqueParticipants} orang`,
                      ];
                    } else {
                      return `Hari Ini: ${divisi.today} absensi`;
                    }
                  },
                },
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  color: "rgba(0,0,0,0.05)",
                },
                ticks: {
                  precision: 0,
                },
              },
              x: {
                grid: {
                  display: false,
                },
              },
            },
          },
        });
      }

      function generateChartColors(count) {
        const colors = [];
        const hueStep = 360 / count;

        for (let i = 0; i < count; i++) {
          const hue = (i * hueStep) % 360;
          colors.push(`hsla(${hue}, 70%, 60%, 0.8)`);
        }

        return colors;
      }

      function updateRankingList() {
        const { ranking } = calculateDivisiStats();
        const container = document.getElementById("rankingList");

        if (!container) return;

        if (ranking.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-chart-bar"></i>
                        <p>Belum ada data absensi</p>
                        <small>Mulai dengan mengisi form absensi</small>
                    </div>
                `;
          return;
        }

        const maxTotal = Math.max(...ranking.map((item) => item.total));

        container.innerHTML = ranking
          .map((item, index) => {
            const percentage = maxTotal > 0 ? (item.total / maxTotal) * 100 : 0;

            return `
                    <div class="ranking-item">
                        <div class="rank-number">${index + 1}</div>
                        <div class="rank-info">
                            <h4>${item.divisi}</h4>
                            <div class="rank-stats">
                                <span><i class="fas fa-clipboard-check"></i> ${item.total} Total</span>
                                <span><i class="fas fa-calendar-day"></i> ${item.today} Hari Ini</span>
                                <span><i class="fas fa-user"></i> ${item.uniqueParticipants} Peserta</span>
                            </div>
                            <div class="rank-bar">
                                <div class="rank-fill" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      // ============================================
      // INITIALIZE APP
      // ============================================
      function initializeApp() {
        updateClock();
        setInterval(updateClock, 1000);
        setupEventListeners();
        showSection(activeSection);
        updateAllDisplays();
      }

      function updateClock() {
        const timeElement = document.getElementById("currentTime");
        const dateElement = document.getElementById("currentDate");

        if (timeElement) {
          timeElement.textContent = formatTime();
        }
        if (dateElement) {
          dateElement.textContent = formatDate();
        }
      }

      function setupEventListeners() {
        // Divisi selection
        document.addEventListener("click", function (e) {
          if (e.target.closest(".divisi-option")) {
            const option = e.target.closest(".divisi-option");
            const divisi = option.dataset.divisi;
            selectDivisi(option, divisi);
          }
        });

        // Input listeners untuk preview
        document.addEventListener("input", function (e) {
          if (e.target.matches("#nama, #kegiatan, #catatan")) {
            updatePreview();
          }
        });
      }

      // ============================================
      // MENU & NAVIGATION
      // ============================================
      window.toggleMenu = function () {
        const sidebar = document.querySelector(".sidebar");
        const overlay = document.querySelector(".sidebar-overlay");
        sidebar.classList.toggle("active");
        overlay.classList.toggle("active");
      };

      window.showSection = function (section) {
        activeSection = section;

        // Update menu
        document.querySelectorAll(".menu-item").forEach((item) => {
          item.classList.remove("active");
          if (item.dataset.section === section) {
            item.classList.add("active");
          }
        });

        // Show section
        document.querySelectorAll(".content-section").forEach((sec) => {
          sec.classList.remove("active");
        });
        document.getElementById(section + "Section")?.classList.add("active");

        // Update chart ketika masuk ke dashboard
        if (section === "dashboard") {
          setTimeout(() => {
            updateDivisiChart();
            updateRankingList();
          }, 100);
        }

        // Update data table ketika masuk ke data section
        if (section === "data") {
          updateFullDataTable();
        }

        // Close sidebar on mobile
        if (window.innerWidth <= 768) {
          toggleMenu();
        }
      };

      window.selectMode = function (mode) {
        currentMode = mode;

        // Update UI
        document.querySelectorAll(".mode-btn").forEach((btn) => {
          btn.classList.remove("active");
          if (
            btn.textContent.includes(
              mode === "individual" ? "Individual" : "Kepanitiaan",
            )
          ) {
            btn.classList.add("active");
          }
        });

        // Show corresponding forms
        document.querySelectorAll(".mode-section").forEach((section) => {
          section.classList.remove("active");
        });
        document.getElementById(mode + "Form")?.classList.add("active");
      };

      // ============================================
      // DIVISI SELECTION
      // ============================================
      window.selectDivisi = function (element, divisi) {
        // Remove active from all
        document.querySelectorAll(".divisi-option").forEach((opt) => {
          opt.classList.remove("active");
        });

        // Add active to clicked
        element.classList.add("active");
        currentDivisi = divisi;

        // Update preview
        updatePreview();
      };

      // ============================================
      // PESERTA MANAGEMENT
      // ============================================
      window.tambahPeserta = function () {
        const nama = document.getElementById("namaPeserta").value.trim();
        const divisi = document.getElementById("divisiPeserta").value;

        if (!nama) {
          showToast("Masukkan nama peserta!", "error");
          return;
        }

        const peserta = {
          id: Date.now(),
          nama: nama,
          divisi: divisi,
          tanggalDaftar: formatDate(),
        };

        const pesertaList = CONFIG.PESERTA_LIST;
        pesertaList.push(peserta);
        localStorage.setItem("irmas_peserta_list", JSON.stringify(pesertaList));

        document.getElementById("namaPeserta").value = "";

        updateAllDisplays();
        showToast("Peserta berhasil ditambahkan!", "success");
      };

      function updatePesertaList() {
        const listElement = document.getElementById("pesertaList");
        const countElement = document.getElementById("pesertaCount");

        if (!listElement) return;

        const pesertaList = CONFIG.PESERTA_LIST;

        if (countElement) {
          countElement.textContent = pesertaList.length;
        }

        if (pesertaList.length === 0) {
          listElement.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-friends"></i>
                        <p>Belum ada peserta terdaftar</p>
                        <small>Tambah peserta untuk memulai</small>
                    </div>
                `;
          return;
        }

        listElement.innerHTML = pesertaList
          .map(
            (peserta) => `
                <div class="peserta-item" data-id="${peserta.id}">
                    <div class="peserta-info">
                        <h4>${peserta.nama}</h4>
                        <small>Divisi: ${peserta.divisi} | Terdaftar: ${peserta.tanggalDaftar}</small>
                    </div>
                    <div class="peserta-actions">
                        <button class="action-small btn-success-sm" onclick="tandaiAbsen(${peserta.id})">
                            <i class="fas fa-check"></i> Absen
                        </button>
                        <button class="action-small btn-danger-sm" onclick="hapusPeserta(${peserta.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `,
          )
          .join("");
      }

      window.tandaiAbsen = function (id) {
        const peserta = CONFIG.PESERTA_LIST.find((p) => p.id === id);
        if (!peserta) return;

        const today = formatDate();
        const sudahAbsen = pesertaAbsen.find(
          (p) => p.id === id && p.tanggalAbsen === today,
        );

        if (sudahAbsen) {
          showToast(`${peserta.nama} sudah absen hari ini!`, "warning");
          return;
        }

        pesertaAbsen.push({
          ...peserta,
          tanggalAbsen: today,
          waktuAbsen: formatTime(),
          kegiatan:
            document.getElementById("kegiatanGroup")?.value ||
            "Kegiatan Harian",
        });

        updatePesertaAbsenList();
        showToast(`${peserta.nama} berhasil ditandai hadir!`, "success");
      };

      function updatePesertaAbsenList() {
        const listElement = document.getElementById("pesertaAbsenList");
        const countElement = document.getElementById("absenCount");

        if (!listElement) return;

        if (countElement) {
          countElement.textContent = pesertaAbsen.length;
        }

        if (pesertaAbsen.length === 0) {
          listElement.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <p>Belum ada peserta yang absen</p>
                        <small>Tandai peserta yang hadir</small>
                    </div>
                `;
          return;
        }

        listElement.innerHTML = pesertaAbsen
          .map(
            (peserta) => `
                <div class="peserta-item" data-id="${peserta.id}">
                    <div class="peserta-info">
                        <h4>${peserta.nama}</h4>
                        <small>Divisi: ${peserta.divisi} | Waktu: ${peserta.waktuAbsen}</small>
                    </div>
                    <button class="action-small btn-danger-sm" onclick="hapusDariAbsen(${peserta.id})">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `,
          )
          .join("");
      }

      window.hapusPeserta = function (id) {
        if (!confirm("Hapus peserta dari daftar?")) return;

        const pesertaList = CONFIG.PESERTA_LIST.filter((p) => p.id !== id);
        localStorage.setItem("irmas_peserta_list", JSON.stringify(pesertaList));

        updateAllDisplays();
        showToast("Peserta berhasil dihapus!", "success");
      };

      window.hapusDariAbsen = function (id) {
        pesertaAbsen = pesertaAbsen.filter((p) => p.id !== id);
        updatePesertaAbsenList();
      };

      // ============================================
      // UPDATE FUNCTIONS
      // ============================================
      function updateStats() {
        const data = CONFIG.ABSENSI_DATA;
        const { ranking } = calculateDivisiStats();

        // Update stat cards
        const today = new Date().toDateString();
        const todayCount = data.filter((item) => {
          return new Date(item.timestamp).toDateString() === today;
        }).length;

        const statElements = {
          totalAbsensi: data.length,
          totalPeserta: CONFIG.PESERTA_LIST.length,
          todayCount: todayCount,
          topDivisi: ranking.length > 0 ? ranking[0].divisi : "-",
          topDivisiCount: ranking.length > 0 ? ranking[0].total : 0,
          totalDivisi: new Set(data.map((item) => item.divisi)).size,
        };

        Object.entries(statElements).forEach(([id, value]) => {
          const element = document.getElementById(id);
          if (element) {
            // Animasi perubahan angka
            const current = parseInt(element.textContent) || 0;
            if (current !== value) {
              animateCounter(element, current, value, 500);
            } else {
              element.textContent = value;
            }
          }
        });
      }

      function animateCounter(element, start, end, duration) {
        const range = end - start;
        const startTime = performance.now();

        function updateCounter(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);

          // Easing function
          const easeOutQuart = 1 - Math.pow(1 - progress, 4);
          const currentValue = Math.floor(start + range * easeOutQuart);

          element.textContent = currentValue;

          if (progress < 1) {
            requestAnimationFrame(updateCounter);
          } else {
            element.textContent = end;
          }
        }

        requestAnimationFrame(updateCounter);
      }

      function updateDataTable() {
        const tbody = document.getElementById("dataTableBody");
        if (!tbody) return;

        const recentData = CONFIG.ABSENSI_DATA.slice(-5).reverse();

        if (recentData.length === 0) {
          tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: var(--gray);">
                            <i class="fas fa-clipboard-list" style="font-size: 48px; margin-bottom: 15px; display: block; opacity: 0.5;"></i>
                            <p>Belum ada data absensi</p>
                            <small>Mulai dengan mengisi form absensi</small>
                        </td>
                    </tr>
                `;
          return;
        }

        tbody.innerHTML = recentData
          .map(
            (data) => `
                <tr>
                    <td>${data.nama}</td>
                    <td>${data.divisi}</td>
                    <td>${data.kegiatan.substring(0, 25)}${data.kegiatan.length > 25 ? "..." : ""}</td>
                    <td>${data.tanggal.split(",")[0]}</td>
                    <td>${data.waktu}</td>
                    <td>
                        <span class="badge ${data.mode === "individual" ? "badge-individual" : "badge-group"}">
                            ${data.mode === "individual" ? "Individual" : "Grup"}
                        </span>
                    </td>
                </tr>
            `,
          )
          .join("");
      }

      function updateFullDataTable() {
        const tbody = document.querySelector("#dataTableFull tbody");
        if (!tbody) return;

        const allData = CONFIG.ABSENSI_DATA.slice().reverse();

        if (allData.length === 0) {
          tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: var(--gray);">
                            <i class="fas fa-database" style="font-size: 48px; margin-bottom: 15px; display: block; opacity: 0.5;"></i>
                            <p>Belum ada data absensi</p>
                            <small>Data akan muncul setelah melakukan absensi</small>
                        </td>
                    </tr>
                `;
          return;
        }

        tbody.innerHTML = allData
          .map(
            (data, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td><strong>${data.nama}</strong></td>
                    <td>${data.divisi}</td>
                    <td>${data.kegiatan}</td>
                    <td>${data.tanggal}</td>
                    <td>${data.waktu}</td>
                    <td>
                        <span class="badge ${data.mode === "individual" ? "badge-individual" : "badge-group"}">
                            ${data.mode === "individual" ? "Individual" : "Grup"}
                        </span>
                    </td>
                </tr>
            `,
          )
          .join("");
      }

      function updatePreview() {
        const nama = document.getElementById("nama")?.value || "[Nama Lengkap]";
        const kegiatan =
          document.getElementById("kegiatan")?.value || "[Kegiatan]";
        const catatan = document.getElementById("catatan")?.value || "";

        const preview = document.getElementById("previewMessage");
        if (!preview) return;

        const message = `ABSENSI IRMAS NURUL FALAH

Tanggal: ${formatDate()}
Waktu: ${formatTime()}

Nama: ${nama}
Divisi: ${currentDivisi}
Kegiatan: ${kegiatan}
${catatan ? `Catatan: ${catatan}\n` : ""}
Data dikirim via Sistem Absensi IRMAS`;

        preview.textContent = message;
      }

      // ============================================
      // ABSENSI INDIVIDUAL
      // ============================================
      window.submitAbsensiIndividual = async function (e) {
        e.preventDefault();

        const nama = document.getElementById("nama").value.trim();
        const kegiatan = document.getElementById("kegiatan").value.trim();
        const catatan = document.getElementById("catatan").value.trim();

        if (!nama || !kegiatan) {
          showToast("Harap isi nama dan kegiatan!", "error");
          return false;
        }

        // Disable button sementara
        const submitBtn =
          e.target.querySelector(".btn-whatsapp") ||
          document.querySelector("#individualForm .btn-whatsapp");
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i> MENGIRIM...';
        submitBtn.disabled = true;

        const today = new Date();
        const absensiData = {
          id: Date.now(),
          nama: nama,
          divisi: currentDivisi,
          kegiatan: kegiatan,
          catatan: catatan,
          tanggal: formatDate(today),
          waktu: formatTime(today),
          timestamp: today.toISOString(),
          mode: "individual",
        };

        // ========== SIMPAN DATA KE LOCALSTORAGE ==========
        saveAbsensiData(absensiData);

        // Kirim WhatsApp
        const message = createWhatsAppMessage(absensiData);
        const whatsappUrl = `https://wa.me/${CONFIG.WHATSAPP_NUMBER}?text=${message}`;

        // Buka WhatsApp
        setTimeout(() => {
          window.open(whatsappUrl, "_blank");

          // Reset button
          setTimeout(() => {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;

            // Reset form
            document.getElementById("absensiForm").reset();
            document.querySelectorAll(".divisi-option").forEach((opt, idx) => {
              opt.classList.remove("active");
              if (idx === 0) opt.classList.add("active");
            });
            currentDivisi = CONFIG.DIVISI_LIST[0];

            updatePreview();

            showToast("Absensi berhasil dikirim! Data diperbarui!", "success");
          }, 1000);
        }, 500);

        return false;
      };

      // ============================================
      // ABSENSI GROUP
      // ============================================
      window.submitAbsensiGroup = function (e) {
        e.preventDefault();

        if (pesertaAbsen.length === 0) {
          showToast("Belum ada peserta yang ditandai hadir!", "error");
          return false;
        }

        const kegiatan = document.getElementById("kegiatanGroup").value.trim();
        const catatan = document.getElementById("catatanGroup").value.trim();

        if (!kegiatan) {
          showToast("Harap isi nama kegiatan!", "error");
          return false;
        }

        // Disable button sementara
        const submitBtn =
          e.target.querySelector(".btn-whatsapp") ||
          document.querySelector("#groupForm .btn-whatsapp");
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i> MENGIRIM...';
        submitBtn.disabled = true;

        const today = new Date();
        const tanggal = formatDate(today);

        // Simpan setiap peserta
        pesertaAbsen.forEach((peserta) => {
          const absensiData = {
            id: Date.now() + Math.random(),
            nama: peserta.nama,
            divisi: peserta.divisi,
            kegiatan: kegiatan,
            catatan: catatan,
            tanggal: tanggal,
            waktu: peserta.waktuAbsen,
            timestamp: today.toISOString(),
            mode: "group",
          };

          // Simpan data
          saveAbsensiData(absensiData);
        });

        // Kirim WhatsApp
        const message = createGroupWhatsAppMessage(
          pesertaAbsen,
          kegiatan,
          catatan,
          tanggal,
        );
        const whatsappUrl = `https://wa.me/${CONFIG.WHATSAPP_NUMBER}?text=${message}`;

        // Buka WhatsApp
        setTimeout(() => {
          window.open(whatsappUrl, "_blank");

          // Reset button
          setTimeout(() => {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;

            // Reset
            pesertaAbsen = [];
            document.getElementById("absensiGroupForm").reset();

            showToast(
              `Absensi grup berhasil dikirim! Data diperbarui!`,
              "success",
            );
          }, 1000);
        }, 500);

        return false;
      };

      // ============================================
      // GENERATE PDF INDIVIDUAL - DENGAN TTD
      // ============================================
      window.generatePDFIndividual = function () {
        const nama = document.getElementById("nama").value.trim();
        const kegiatan = document.getElementById("kegiatan").value.trim();
        const catatan = document.getElementById("catatan").value.trim();

        if (!nama || !kegiatan) {
          showToast("Harap isi nama dan kegiatan terlebih dahulu!", "error");
          return;
        }

        const today = new Date();

        // ========== SIMPAN DATA SAAT DOWNLOAD PDF ==========
        const absensiData = {
          id: Date.now(),
          nama: nama,
          divisi: currentDivisi,
          kegiatan: kegiatan,
          catatan: catatan,
          tanggal: formatDate(today),
          waktu: formatTime(today),
          timestamp: today.toISOString(),
          mode: "individual",
        };

        saveAbsensiData(absensiData);
        // ====================================================

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Header dengan logo
        doc.setFontSize(20);
        doc.setTextColor(67, 97, 238);
        doc.text("FORMULIR ABSENSI INDIVIDUAL", 105, 20, null, null, "center");

        doc.setFontSize(14);
        doc.setTextColor(58, 12, 163);
        doc.text("IRMAS NURUL FALAH", 105, 28, null, null, "center");

        // Line separator
        doc.setDrawColor(67, 97, 238);
        doc.setLineWidth(0.5);
        doc.line(20, 35, 190, 35);

        // Content
        doc.setFontSize(11);
        doc.setTextColor(0, 0, 0);
        let yPos = 45;

        // Data fields
        const fields = [
          { label: "ID Absensi", value: `IRMAS-${Date.now()}` },
          { label: "Tanggal", value: formatDate(today) },
          { label: "Waktu", value: formatTime(today) },
          { label: "Nama Lengkap", value: nama },
          { label: "Divisi", value: currentDivisi },
          { label: "Kegiatan", value: kegiatan },
          { label: "Catatan", value: catatan || "-" },
        ];

        fields.forEach((field) => {
          doc.setFont("helvetica", "bold");
          doc.text(`${field.label}:`, 30, yPos);
          doc.setFont("helvetica", "normal");

          const lines = doc.splitTextToSize(field.value, 120);
          if (lines.length > 1) {
            doc.text(lines, 70, yPos);
            yPos += lines.length * 7;
          } else {
            doc.text(field.value, 70, yPos);
            yPos += 10;
          }

          yPos += 3;
        });

        // Ranking Divisi di PDF
        const { ranking } = calculateDivisiStats();
        yPos += 10;

        doc.setFontSize(12);
        doc.setFont("helvetica", "bold");
        doc.text("RANKING KEHADIRAN DIVISI:", 105, yPos, null, null, "center");
        yPos += 8;

        doc.setFontSize(9);
        doc.setFont("helvetica", "normal");

        ranking.slice(0, 5).forEach((item, index) => {
          doc.text(
            `${index + 1}. ${item.divisi}: ${item.total} absensi`,
            30,
            yPos,
          );
          yPos += 6;
        });

        // Signature area dengan nama lengkap
        yPos += 15;
        doc.setFontSize(10);
        doc.setFont("helvetica", "italic");
        doc.text("Mengetahui,", 105, yPos, null, null, "center");

        yPos += 20;
        doc.setDrawColor(0, 0, 0);
        doc.setLineWidth(0.5);

        // TTD Ketua Umum
        doc.line(30, yPos, 80, yPos);
        doc.text("Ketua Umum", 55, yPos + 5, null, null, "center");
        doc.setFont("helvetica", "normal");
        doc.setFontSize(9);
        doc.text(
          CONFIG.ORGANIZATION.KETUA_UMUM,
          55,
          yPos + 10,
          null,
          null,
          "center",
        );

        // TTD Sekretaris
        doc.line(120, yPos, 170, yPos);
        doc.text("Sekretaris", 145, yPos + 5, null, null, "center");
        doc.text(
          CONFIG.ORGANIZATION.SEKRETARIS,
          145,
          yPos + 10,
          null,
          null,
          "center",
        );

        // Footer
        doc.setFontSize(8);
        doc.setTextColor(100, 100, 100);
        doc.text(
          "Dokumen ini digenerate otomatis oleh Sistem Absensi IRMAS",
          105,
          280,
          null,
          null,
          "center",
        );

        // Save PDF
        const fileName = `Absensi_${nama.replace(/\s+/g, "_")}_${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear()}.pdf`;
        doc.save(fileName);

        showToast(`PDF berhasil didownload dan data tersimpan!`, "success");
      };

      // ============================================
      // GENERATE PDF GROUP - DENGAN TTD
      // ============================================
      window.generatePDFGroup = function () {
        if (pesertaAbsen.length === 0) {
          showToast("Belum ada peserta yang ditandai hadir!", "error");
          return;
        }

        const kegiatan =
          document.getElementById("kegiatanGroup")?.value.trim() ||
          "Kegiatan Kepanitiaan";
        const catatan = document.getElementById("catatanGroup")?.value.trim();
        const today = new Date();
        const tanggal = formatDate(today);

        // ========== SIMPAN DATA SAAT DOWNLOAD PDF ==========
        pesertaAbsen.forEach((peserta) => {
          const absensiData = {
            id: Date.now() + Math.random(),
            nama: peserta.nama,
            divisi: peserta.divisi,
            kegiatan: kegiatan,
            catatan: catatan,
            tanggal: tanggal,
            waktu: peserta.waktuAbsen,
            timestamp: today.toISOString(),
            mode: "group",
          };

          saveAbsensiData(absensiData);
        });
        // ====================================================

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Header
        doc.setFontSize(20);
        doc.setTextColor(67, 97, 238);
        doc.text("DAFTAR HADIR KEPANITIAAN", 105, 15, null, null, "center");

        doc.setFontSize(14);
        doc.setTextColor(58, 12, 163);
        doc.text("IRMAS NURUL FALAH", 105, 22, null, null, "center");

        // Info Kegiatan
        doc.setFontSize(11);
        doc.setTextColor(0, 0, 0);
        doc.text(`Kegiatan: ${kegiatan}`, 20, 35);
        doc.text(`Tanggal: ${formatDate(today)}`, 20, 42);
        doc.text(`Waktu: ${formatTime(today)}`, 20, 49);
        doc.text(`Jumlah Peserta: ${pesertaAbsen.length} orang`, 20, 56);

        if (catatan) {
          doc.text(`Catatan: ${catatan}`, 20, 63);
        }

        // Ranking Divisi di PDF
        const { ranking } = calculateDivisiStats();
        doc.text("Ranking Kehadiran Divisi:", 20, 70);

        let rankY = 76;
        ranking.slice(0, 3).forEach((item, index) => {
          doc.text(
            `${index + 1}. ${item.divisi}: ${item.total} absensi`,
            25,
            rankY,
          );
          rankY += 6;

          if (rankY > 270) {
            doc.addPage();
            rankY = 20;
          }
        });

        // Table
        let yPos = 90;
        const headers = ["No", "Nama", "Divisi", "Waktu", "TTD"];
        const colWidths = [15, 70, 40, 35, 30];
        let xPos = 20;

        // Table header
        doc.setFillColor(67, 97, 238);
        doc.rect(xPos, yPos, 170, 8, "F");
        doc.setTextColor(255, 255, 255);
        doc.setFont("helvetica", "bold");

        headers.forEach((header, i) => {
          doc.text(header, xPos + 5, yPos + 6);
          xPos += colWidths[i];
        });

        // Table rows
        yPos += 10;
        doc.setTextColor(0, 0, 0);
        doc.setFont("helvetica", "normal");

        pesertaAbsen.forEach((peserta, index) => {
          if (yPos > 200) {
            // Jika hampir penuh, buat halaman baru
            doc.addPage();
            yPos = 20;

            // Header tabel di halaman baru
            xPos = 20;
            doc.setFillColor(67, 97, 238);
            doc.rect(xPos, yPos, 170, 8, "F");
            doc.setTextColor(255, 255, 255);
            doc.setFont("helvetica", "bold");

            headers.forEach((header, i) => {
              doc.text(header, xPos + 5, yPos + 6);
              xPos += colWidths[i];
            });
            yPos += 10;
            xPos = 20;
          }

          xPos = 20;
          doc.text(`${index + 1}`, xPos + 5, yPos + 5);
          xPos += colWidths[0];

          doc.text(peserta.nama, xPos + 5, yPos + 5);
          xPos += colWidths[1];

          doc.text(peserta.divisi, xPos + 5, yPos + 5);
          xPos += colWidths[2];

          doc.text(peserta.waktuAbsen, xPos + 5, yPos + 5);
          xPos += colWidths[3];

          // Signature line
          doc.setDrawColor(200, 200, 200);
          doc.setLineWidth(0.3);
          doc.line(xPos, yPos, xPos + 25, yPos);

          yPos += 8;
        });

        // Signature area dengan nama lengkap
        if (yPos > 200) {
          doc.addPage();
          yPos = 30;
        } else {
          yPos += 10;
        }

        doc.setFontSize(10);
        doc.setFont("helvetica", "italic");
        doc.text("Mengetahui,", 105, yPos, null, null, "center");

        yPos += 20;
        doc.setDrawColor(0, 0, 0);
        doc.setLineWidth(0.5);

        // TTD Ketua Umum
        doc.line(30, yPos, 80, yPos);
        doc.text("Ketua Umum", 55, yPos + 5, null, null, "center");
        doc.setFont("helvetica", "normal");
        doc.setFontSize(9);
        doc.text(
          CONFIG.ORGANIZATION.KETUA_UMUM,
          55,
          yPos + 10,
          null,
          null,
          "center",
        );

        // TTD Sekretaris
        doc.line(120, yPos, 170, yPos);
        doc.text("Sekretaris", 145, yPos + 5, null, null, "center");
        doc.text(
          CONFIG.ORGANIZATION.SEKRETARIS,
          145,
          yPos + 10,
          null,
          null,
          "center",
        );

        // Footer
        doc.setFontSize(8);
        doc.setTextColor(100, 100, 100);
        doc.text(
          "Dokumen ini digenerate otomatis oleh Sistem Absensi IRMAS",
          105,
          280,
          null,
          null,
          "center",
        );

        // Save PDF
        const fileName = `Daftar_Hadir_${kegiatan.replace(/\s+/g, "_")}_${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear()}.pdf`;
        doc.save(fileName);

        showToast(
          "PDF daftar hadir berhasil didownload dan data tersimpan!",
          "success",
        );
      };

      // ============================================
      // WHATSAPP MESSAGES
      // ============================================
      function createWhatsAppMessage(data) {
        let message = `ABSENSI INDIVIDUAL IRMAS NURUL FALAH%0A%0A`;
        message += `Tanggal: ${data.tanggal}%0A`;
        message += `Waktu: ${data.waktu}%0A%0A`;
        message += `Nama: ${encodeURIComponent(data.nama)}%0A`;
        message += `Divisi: ${data.divisi}%0A`;
        message += `Kegiatan: ${encodeURIComponent(data.kegiatan)}%0A`;

        if (data.catatan) {
          message += `Catatan: ${encodeURIComponent(data.catatan)}%0A`;
        }

        message += `%0AMode: Individual%0AData dikirim via Sistem Absensi IRMAS`;

        return message;
      }

      function createGroupWhatsAppMessage(peserta, kegiatan, catatan, tanggal) {
        let message = `ABSENSI GRUP IRMAS NURUL FALAH%0A%0A`;
        message += ` ${tanggal}%0A`;
        message += ` ${encodeURIComponent(kegiatan)}%0A%0A`;
        message += ` DAFTAR HADIR (${peserta.length} orang):%0A%0A`;

        peserta.forEach((p, index) => {
          message += `${index + 1}. ${encodeURIComponent(p.nama)}%0A`;
          message += `   Divisi: ${p.divisi}%0A`;
          message += `   Waktu: ${p.waktuAbsen}%0A%0A`;
        });

        if (catatan) {
          message += ` Catatan: ${encodeURIComponent(catatan)}%0A`;
        }

        message += `%0AMode: Grup Kepanitiaan%0AData dikirim via Sistem Absensi IRMAS`;

        return message;
      }

      // ============================================
      // LAPORAN LENGKAP DENGAN RANKING
      // ============================================
      window.generateLaporan = function () {
        if (CONFIG.ABSENSI_DATA.length === 0) {
          showToast("Belum ada data absensi!", "warning");
          return;
        }

        const today = new Date();
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const { ranking } = calculateDivisiStats();

        // Header
        doc.setFontSize(20);
        doc.setTextColor(67, 97, 238);
        doc.text("LAPORAN ABSENSI LENGKAP", 105, 15, null, null, "center");

        doc.setFontSize(14);
        doc.setTextColor(58, 12, 163);
        doc.text("IRMAS NURUL FALAH", 105, 22, null, null, "center");

        // Info Laporan
        doc.setFontSize(10);
        doc.setTextColor(100, 100, 100);
        doc.text(
          `Dicetak: ${formatDate(today)} ${formatTime(today)}`,
          105,
          30,
          null,
          null,
          "center",
        );
        doc.text(
          `Total Data: ${CONFIG.ABSENSI_DATA.length} absensi`,
          105,
          36,
          null,
          null,
          "center",
        );

        // Struktur Organisasi
        let yPos = 50;
        doc.setFontSize(12);
        doc.setTextColor(0, 0, 0);
        doc.text("STRUKTUR ORGANISASI:", 20, yPos);
        yPos += 8;

        doc.setFontSize(10);
        doc.text(`Ketua Umum: ${CONFIG.ORGANIZATION.KETUA_UMUM}`, 25, yPos);
        yPos += 6;
        doc.text(`Sekretaris: ${CONFIG.ORGANIZATION.SEKRETARIS}`, 25, yPos);
        yPos += 6;
        doc.text(`Wakil Ketua: ${CONFIG.ORGANIZATION.WAKIL_KETUA}`, 25, yPos);
        yPos += 6;
        doc.text(`Bendahara: ${CONFIG.ORGANIZATION.BENDAHARA}`, 25, yPos);
        yPos += 10;

        // Ranking Divisi
        doc.setFontSize(12);
        doc.text("RANKING KEHADIRAN DIVISI:", 20, yPos);
        yPos += 8;

        doc.setFontSize(10);
        ranking.forEach((item, index) => {
          doc.text(
            `${index + 1}. ${item.divisi}: ${item.total} absensi (${item.uniqueParticipants} peserta)`,
            25,
            yPos,
          );
          yPos += 6;

          if (yPos > 270) {
            doc.addPage();
            yPos = 20;
          }
        });

        // Table data lengkap
        yPos += 10;
        const headers = ["No", "Nama", "Divisi", "Kegiatan", "Tanggal", "Mode"];
        const colWidths = [10, 40, 30, 60, 30, 20];

        CONFIG.ABSENSI_DATA.forEach((data, index) => {
          if (yPos > 270) {
            doc.addPage();
            yPos = 20;
          }

          if (index === 0 || yPos === 20) {
            // Table header
            doc.setFillColor(230, 230, 230);
            doc.rect(10, yPos, 190, 8, "F");
            doc.setTextColor(0, 0, 0);
            doc.setFont("helvetica", "bold");

            let xPos = 10;
            headers.forEach((header, i) => {
              doc.text(header, xPos + 5, yPos + 6);
              xPos += colWidths[i];
            });
            yPos += 10;
          }

          // Table row
          doc.setFont("helvetica", "normal");
          doc.setFontSize(9);

          let xPos = 10;
          doc.text(`${index + 1}`, xPos + 5, yPos + 5);
          xPos += colWidths[0];

          doc.text(data.nama.substring(0, 18), xPos + 5, yPos + 5);
          xPos += colWidths[1];

          doc.text(data.divisi, xPos + 5, yPos + 5);
          xPos += colWidths[2];

          doc.text(data.kegiatan.substring(0, 25), xPos + 5, yPos + 5);
          xPos += colWidths[3];

          doc.text(data.tanggal.split(",")[0], xPos + 5, yPos + 5);
          xPos += colWidths[4];

          doc.text(data.mode === "group" ? "Grup" : "Indv", xPos + 5, yPos + 5);

          yPos += 7;
        });

        // TTD di halaman terakhir
        if (yPos > 200) {
          doc.addPage();
          yPos = 30;
        }

        yPos += 10;
        doc.setFontSize(10);
        doc.setFont("helvetica", "italic");
        doc.text("Mengetahui,", 105, yPos, null, null, "center");

        yPos += 20;
        doc.setDrawColor(0, 0, 0);
        doc.setLineWidth(0.5);

        // TTD Ketua Umum
        doc.line(30, yPos, 80, yPos);
        doc.text("Ketua Umum", 55, yPos + 5, null, null, "center");
        doc.setFont("helvetica", "normal");
        doc.setFontSize(9);
        doc.text(
          CONFIG.ORGANIZATION.KETUA_UMUM,
          55,
          yPos + 10,
          null,
          null,
          "center",
        );

        // TTD Sekretaris
        doc.line(120, yPos, 170, yPos);
        doc.text("Sekretaris", 145, yPos + 5, null, null, "center");
        doc.text(
          CONFIG.ORGANIZATION.SEKRETARIS,
          145,
          yPos + 10,
          null,
          null,
          "center",
        );

        // Save PDF
        const fileName = `Laporan_Absensi_${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear()}.pdf`;
        doc.save(fileName);

        showToast("Laporan berhasil didownload!", "success");
      };

      // ============================================
      // AUTHENTICATION & RENDERING
      // ============================================
      document.addEventListener("DOMContentLoaded", function () {
        const isLoggedIn = localStorage.getItem("irmas_auth") === "true";

        if (!isLoggedIn) {
          renderLoginPage();
        } else {
          renderDashboard();
        }
      });

      function renderLoginPage() {
        document.getElementById("app").innerHTML = `
                <div class="login-container">
                    <div class="login-card">
                        <div class="login-header">
                            <div class="login-logo">
                                <i class="fas fa-mosque"></i>
                            </div>
                            <h1 class="login-title">IRMAS Absensi</h1>
                            <p class="login-subtitle">Sistem dengan TTD & Real-time Update</p>
                        </div>
                        
                        <form onsubmit="return handleLogin(event)">
                            <div class="input-group">
                                <label><i class="fas fa-user"></i> Username</label>
                                <input type="text" id="username" value="irmas" required>
                            </div>
                            
                            <div class="input-group">
                                <label><i class="fas fa-lock"></i> Password</label>
                                <div class="password-container">
                                    <input type="password" id="password" value="falah2024" required>
                                    <button type="button" class="toggle-password" onclick="togglePassword()">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="features">
                                <div class="feature">
                                    <i class="fas fa-signature"></i>
                                    <span>TTD Lengkap</span>
                                </div>
                                <div class="feature">
                                    <i class="fas fa-chart-line"></i>
                                    <span>Real-time Update</span>
                                </div>
                                <div class="feature">
                                    <i class="fas fa-trophy"></i>
                                    <span>Ranking Divisi</span>
                                </div>
                                <div class="feature">
                                    <i class="fas fa-database"></i>
                                    <span>Data Otomatis</span>
                                </div>
                            </div>
                            
                            <button type="submit" class="login-btn">
                                <i class="fas fa-sign-in-alt"></i> MASUK KE SISTEM
                            </button>
                        </form>
                        
                        <div class="login-footer">
                            <p class="dev-info">Sistem Absensi IRMAS - Update Real-time</p>
                        </div>
                    </div>
                </div>
            `;
      }

      window.handleLogin = function (e) {
        e.preventDefault();

        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        if (username === "irmas" && password === "falah2024") {
          localStorage.setItem("irmas_auth", "true");
          renderDashboard();
          showToast("Login berhasil!", "success");
          return false;
        } else {
          showToast("Username atau password salah!", "error");
          return false;
        }
      };

      window.togglePassword = function () {
        const passwordInput = document.getElementById("password");
        const toggleBtn = document.querySelector(".toggle-password i");

        if (passwordInput.type === "password") {
          passwordInput.type = "text";
          toggleBtn.classList.remove("fa-eye");
          toggleBtn.classList.add("fa-eye-slash");
        } else {
          passwordInput.type = "password";
          toggleBtn.classList.remove("fa-eye-slash");
          toggleBtn.classList.add("fa-eye");
        }
      };

      function renderDashboard() {
        const today = new Date();
        const currentDate = formatDate(today);
        const currentTime = formatTime(today);
        const { ranking } = calculateDivisiStats();

        document.getElementById("app").innerHTML = `
                <div class="dashboard">
                    <!-- Navbar -->
                    <nav class="navbar">
                        <div class="nav-content">
                            <div class="nav-brand">
                                <i class="fas fa-mosque"></i>
                                <div>
                                    <h1>IRMAS Absensi System</h1>
                                    <small style="font-size: 12px; color: var(--gray);">Real-time Update & TTD Lengkap</small>
                                </div>
                            </div>
                            <div class="nav-stats" id="navStats">
                                <span class="stat-badge">
                                    <i class="fas fa-trophy"></i>
                                    Top: ${ranking.length > 0 ? ranking[0].divisi : "-"}
                                </span>
                                <span class="stat-badge" style="background: #4cc9f0; color: white;">
                                    <i class="fas fa-users"></i>
                                    ${CONFIG.ABSENSI_DATA.length} Data
                                </span>
                            </div>
                            <button class="hamburger-btn" onclick="toggleMenu()">
                                <i class="fas fa-bars"></i>
                            </button>
                        </div>
                    </nav>
                    
                    <!-- Sidebar -->
                    <div class="sidebar">
                        <div class="sidebar-header">
                            <div class="sidebar-user">
                                <div class="user-avatar">
                                    <i class="fas fa-user-tie"></i>
                                </div>
                                <div class="user-info">
                                    <h3>Admin IRMAS</h3>
                                    <p>${currentDate}</p>
                                    <small style="font-size: 11px; opacity: 0.8;">
                                        <i class="fas fa-bolt"></i> Data Update Real-time
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="sidebar-menu">
                            <a href="#" class="menu-item active" data-section="dashboard" onclick="showSection('dashboard')">
                                <i class="fas fa-home"></i>
                                <span>Dashboard</span>
                                <small style="margin-left: auto; font-size: 10px; background: var(--primary); color: white; padding: 2px 6px; border-radius: 10px;" id="todayCountBadge">0</small>
                            </a>
                            <a href="#" class="menu-item" data-section="individual" onclick="showSection('individual')">
                                <i class="fas fa-user"></i>
                                <span>Absensi Individual</span>
                            </a>
                            <a href="#" class="menu-item" data-section="group" onclick="showSection('group')">
                                <i class="fas fa-users"></i>
                                <span>Kepanitiaan</span>
                            </a>
                            <a href="#" class="menu-item" data-section="data" onclick="showSection('data')">
                                <i class="fas fa-database"></i>
                                <span>Data & Laporan</span>
                                <small style="margin-left: auto; font-size: 10px; background: var(--success); color: white; padding: 2px 6px; border-radius: 10px;">${CONFIG.ABSENSI_DATA.length}</small>
                            </a>
                            <a href="#" class="menu-item" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Keluar</span>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Sidebar Overlay -->
                    <div class="sidebar-overlay" onclick="toggleMenu()"></div>
                    
                    <!-- Main Content -->
                    <div class="main-content">
                        <!-- Welcome Card -->
                        <div class="welcome-card">
                            <div class="welcome-text">
                                <h2>Selamat Datang, Admin IRMAS!</h2>
                                <p>Sistem Absensi dengan Update Real-time & TTD Lengkap</p>
                                <small style="display: flex; align-items: center; gap: 5px; margin-top: 5px;">
                                    <i class="fas fa-bolt"></i>
                                    <span>Data update otomatis saat absensi!</span>
                                </small>
                            </div>
                            <div class="date-info">
                                <div class="time" id="currentTime">${currentTime}</div>
                                <div class="date" id="currentDate">${currentDate}</div>
                            </div>
                        </div>
                        
                        <!-- Dashboard Section -->
                        <section id="dashboardSection" class="content-section active">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="stat-number" id="totalAbsensi">${CONFIG.ABSENSI_DATA.length}</div>
                                    <div class="stat-label">Total Absensi</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-user-friends"></i>
                                    </div>
                                    <div class="stat-number" id="totalPeserta">${CONFIG.PESERTA_LIST.length}</div>
                                    <div class="stat-label">Total Peserta</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-calendar-day"></i>
                                    </div>
                                    <div class="stat-number" id="todayCount">${
                                      CONFIG.ABSENSI_DATA.filter((item) => {
                                        const itemDate = new Date(
                                          item.timestamp,
                                        ).toDateString();
                                        const today = new Date().toDateString();
                                        return itemDate === today;
                                      }).length
                                    }</div>
                                    <div class="stat-label">Hari Ini</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-trophy"></i>
                                    </div>
                                    <div class="stat-number" id="topDivisi">${ranking.length > 0 ? ranking[0].divisi : "-"}</div>
                                    <div class="stat-label">Divisi Terbaik</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="stat-number" id="topDivisiCount">${ranking.length > 0 ? ranking[0].total : 0}</div>
                                    <div class="stat-label">Absensi Terbaik</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-sitemap"></i>
                                    </div>
                                    <div class="stat-number" id="totalDivisi">${new Set(CONFIG.ABSENSI_DATA.map((item) => item.divisi)).size}</div>
                                    <div class="stat-label">Divisi Aktif</div>
                                </div>
                            </div>
                            
                            <!-- Chart Ranking Divisi -->
                            <div class="chart-container">
                                <div class="chart-header">
                                    <h3><i class="fas fa-chart-bar"></i> Statistik Kehadiran per Divisi</h3>
                                    <small style="color: var(--gray);">
                                        Update real-time saat absensi
                                    </small>
                                </div>
                                <div class="chart-wrapper">
                                    <canvas id="divisiChart"></canvas>
                                </div>
                            </div>
                            
                            <!-- Ranking List -->
                            <div class="ranking-container">
                                <div class="ranking-header">
                                    <h3><i class="fas fa-trophy"></i> Ranking Divisi</h3>
                                    <small style="color: var(--gray);">
                                        Update otomatis saat ada data baru
                                    </small>
                                </div>
                                <div class="ranking-list" id="rankingList">
                                    <!-- Ranking akan diisi oleh JavaScript -->
                                </div>
                            </div>
                            
                            <div class="form-card">
                                <div class="form-header">
                                    <i class="fas fa-bolt"></i>
                                    <h3>Aksi Cepat</h3>
                                </div>
                                
                                <div class="action-buttons">
                                    <button class="action-btn btn-individual" onclick="showSection('individual')">
                                        <i class="fas fa-user-plus"></i> Absensi Individual
                                    </button>
                                    <button class="action-btn btn-group" onclick="showSection('group')">
                                        <i class="fas fa-users"></i> Mode Kepanitiaan
                                    </button>
                                    <button class="action-btn btn-report" onclick="generateLaporan()">
                                        <i class="fas fa-file-pdf"></i> Generate Laporan
                                    </button>
                                </div>
                            </div>
                            
                            <div class="form-card">
                                <div class="form-header">
                                    <i class="fas fa-history"></i>
                                    <h3>Absensi Terbaru</h3>
                                    <small style="margin-left: auto; color: var(--gray);">
                                        Update real-time
                                    </small>
                                </div>
                                
                                <div class="data-table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Nama</th>
                                                <th>Divisi</th>
                                                <th>Kegiatan</th>
                                                <th>Tanggal</th>
                                                <th>Waktu</th>
                                                <th>Mode</th>
                                            </tr>
                                        </thead>
                                        <tbody id="dataTableBody">
                                            <!-- Data akan diisi oleh JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </section>
                        
                        <!-- Individual Section -->
                        <section id="individualSection" class="content-section">
                            <div class="mode-selector">
                                <button class="mode-btn active" onclick="selectMode('individual')">
                                    <i class="fas fa-user"></i> Mode Individual
                                </button>
                                <button class="mode-btn" onclick="selectMode('group')">
                                    <i class="fas fa-users"></i> Mode Kepanitiaan
                                </button>
                            </div>
                            
                            <div id="individualForm" class="mode-section form-card active">
                                <div class="form-header">
                                    <i class="fas fa-user-check"></i>
                                    <h3>Form Absensi Individual</h3>
                                    <small style="margin-left: auto; color: var(--primary);">
                                        <i class="fas fa-bolt"></i> Data masuk real-time
                                    </small>
                                </div>
                                
                                <form id="absensiForm" onsubmit="return submitAbsensiIndividual(event)">
                                    <div class="input-group">
                                        <label><i class="fas fa-user"></i> Nama Lengkap</label>
                                        <input type="text" id="nama" placeholder="Masukkan nama lengkap" required>
                                    </div>
                                    
                                    <div class="input-group">
                                        <label><i class="fas fa-users"></i> Pilih Divisi</label>
                                        <div class="divisi-grid">
                                            ${CONFIG.DIVISI_LIST.map(
                                              (div, idx) => `
                                                <div class="divisi-option ${idx === 0 ? "active" : ""}" 
                                                     data-divisi="${div}">
                                                    <i class="fas ${getDivisiIcon(div)}"></i>
                                                    <span>${div}</span>
                                                </div>
                                            `,
                                            ).join("")}
                                        </div>
                                    </div>
                                    
                                    <div class="input-group">
                                        <label><i class="fas fa-tasks"></i> Kegiatan</label>
                                        <input type="text" id="kegiatan" placeholder="Nama kegiatan yang dihadiri" required>
                                    </div>
                                    
                                    <div class="input-group">
                                        <label><i class="fas fa-sticky-note"></i> Catatan (Opsional)</label>
                                        <textarea id="catatan" placeholder="Tambahkan catatan jika perlu..." rows="3"></textarea>
                                    </div>
                                    
                                    <div class="action-buttons">
                                        <button type="button" class="action-btn btn-pdf" onclick="generatePDFIndividual()">
                                            <i class="fas fa-file-pdf"></i> Download PDF + Simpan Data
                                        </button>
                                        <button type="submit" class="action-btn btn-whatsapp">
                                            <i class="fab fa-whatsapp"></i> Kirim WhatsApp + Simpan Data
                                        </button>
                                    </div>
                                </form>
                                
                                <div class="preview-card">
                                    <div class="preview-header">
                                        <i class="fas fa-eye"></i>
                                        <h4>Preview Pesan WhatsApp</h4>
                                    </div>
                                    <div class="preview-content" id="previewMessage">
                                        ABSENSI IRMAS NURUL FALAH

Tanggal: ${currentDate}
Waktu: ${currentTime}

Nama: [Nama Lengkap]
Divisi: [Divisi]
Kegiatan: [Kegiatan]
Catatan: [Opsional]

Data dikirim via Sistem Absensi IRMAS
                                    </div>
                                </div>
                                
                                <div style="margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: var(--border-radius); border-left: 4px solid #4caf50;">
                                    <div style="display: flex; align-items: center; gap: 10px; color: #2e7d32;">
                                        <i class="fas fa-info-circle"></i>
                                        <strong>Fitur Real-time:</strong>
                                    </div>
                                    <p style="margin-top: 10px; font-size: 14px; color: #555;">
                                        Data akan otomatis tersimpan ke sistem dan update di:
                                        <br> Dashboard & Grafik
                                        <br> Menu Data & Laporan
                                        <br> Ranking Divisi
                                        <br> Statistik
                                    </p>
                                </div>
                            </div>
                        </section>
                        
                        <!-- Group Section -->
                        <section id="groupSection" class="content-section">
                            <div class="mode-selector">
                                <button class="mode-btn" onclick="selectMode('individual')">
                                    <i class="fas fa-user"></i> Mode Individual
                                </button>
                                <button class="mode-btn active" onclick="selectMode('group')">
                                    <i class="fas fa-users"></i> Mode Kepanitiaan
                                </button>
                            </div>
                            
                            <div id="groupForm" class="mode-section form-card active">
                                <div class="form-header">
                                    <i class="fas fa-users"></i>
                                    <h3>Manajemen Kepanitiaan</h3>
                                    <small style="margin-left: auto; color: var(--primary);">
                                        <i class="fas fa-bolt"></i> Update real-time
                                    </small>
                                </div>
                                
                                <div class="peserta-section">
                                    <div class="section-title">
                                        <i class="fas fa-user-plus"></i>
                                        <span>Tambah Anggota</span>
                                    </div>
                                    <div class="quick-add-form">
                                        <div class="quick-add-grid">
                                            <div class="input-group" style="margin: 0;">
                                                <input type="text" id="namaPeserta" placeholder="Nama anggota" style="margin: 0;">
                                            </div>
                                            <div class="input-group" style="margin: 0;">
                                                <select id="divisiPeserta" style="margin: 0;">
                                                    ${CONFIG.DIVISI_LIST.map((div) => `<option value="${div}">${div}</option>`).join("")}
                                                </select>
                                            </div>
                                            <button type="button" onclick="tambahPeserta()" style="background: var(--primary); color: white; border: none; padding: 14px 20px; border-radius: var(--border-radius); cursor: pointer; font-weight: 600;">
                                                <i class="fas fa-plus"></i> Tambah
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="peserta-section">
                                    <div class="section-title">
                                        <i class="fas fa-list"></i>
                                        <span>Daftar Anggota (<span id="pesertaCount">${CONFIG.PESERTA_LIST.length}</span>)</span>
                                    </div>
                                    <div id="pesertaList" class="peserta-list"></div>
                                </div>
                                
                                <form id="absensiGroupForm" onsubmit="return submitAbsensiGroup(event)">
                                    <div class="input-group">
                                        <label><i class="fas fa-calendar"></i> Kegiatan Kepanitiaan</label>
                                        <input type="text" id="kegiatanGroup" placeholder="Nama kegiatan kepanitiaan" required>
                                    </div>
                                    
                                    <div class="input-group">
                                        <label><i class="fas fa-sticky-note"></i> Catatan</label>
                                        <textarea id="catatanGroup" placeholder="Catatan untuk kegiatan..." rows="3"></textarea>
                                    </div>
                                    
                                    <div class="peserta-section">
                                        <div class="section-title">
                                            <i class="fas fa-check-circle"></i>
                                            <span>Daftar Hadir Hari Ini (<span id="absenCount">0</span>)</span>
                                        </div>
                                        <div id="pesertaAbsenList" class="peserta-list"></div>
                                    </div>
                                    
                                    <div class="action-buttons">
                                        <button type="button" class="action-btn btn-pdf" onclick="generatePDFGroup()">
                                            <i class="fas fa-file-pdf"></i> PDF + Simpan Semua Data
                                        </button>
                                        <button type="submit" class="action-btn btn-whatsapp">
                                            <i class="fab fa-whatsapp"></i> WA Grup + Simpan Data
                                        </button>
                                    </div>
                                </form>
                                
                                <div style="margin-top: 20px; padding: 15px; background: #fff3e0; border-radius: var(--border-radius); border-left: 4px solid #ff9800;">
                                    <div style="display: flex; align-items: center; gap: 10px; color: #ef6c00;">
                                        <i class="fas fa-sync-alt"></i>
                                        <strong>Update Otomatis:</strong>
                                    </div>
                                    <p style="margin-top: 10px; font-size: 14px; color: #555;">
                                        Setiap peserta yang diabsensi akan otomatis masuk ke:
                                        <br> Database sistem
                                        <br> Grafik ranking divisi
                                        <br> Laporan lengkap
                                        <br> Statistik real-time
                                    </p>
                                </div>
                            </div>
                        </section>
                        
                        <!-- Data Section -->
                        <section id="dataSection" class="content-section">
                            <div class="form-card">
                                <div class="form-header">
                                    <i class="fas fa-database"></i>
                                    <h3>Data & Laporan</h3>
                                    <small style="margin-left: auto; color: var(--success);">
                                        <i class="fas fa-bolt"></i> Update real-time
                                    </small>
                                </div>
                                
                                <div class="stats-grid" style="margin-top: 20px;">
                                    <div class="stat-card" style="background: #e8f5e9;">
                                        <div class="stat-icon" style="background: #4caf50;">
                                            <i class="fas fa-database"></i>
                                        </div>
                                        <div class="stat-number">${CONFIG.ABSENSI_DATA.length}</div>
                                        <div class="stat-label">Total Data Absensi</div>
                                    </div>
                                    <div class="stat-card" style="background: #e3f2fd;">
                                        <div class="stat-icon" style="background: #2196f3;">
                                            <i class="fas fa-history"></i>
                                        </div>
                                        <div class="stat-number">${new Set(CONFIG.ABSENSI_DATA.map((d) => d.tanggal.split(",")[0])).size}</div>
                                        <div class="stat-label">Hari Aktif</div>
                                    </div>
                                    <div class="stat-card" style="background: #f3e5f5;">
                                        <div class="stat-icon" style="background: #9c27b0;">
                                            <i class="fas fa-user-check"></i>
                                        </div>
                                        <div class="stat-number">${new Set(CONFIG.ABSENSI_DATA.map((d) => d.nama)).size}</div>
                                        <div class="stat-label">Peserta Unik</div>
                                    </div>
                                </div>
                                
                                <div class="action-buttons" style="margin-top: 30px;">
                                    <button class="action-btn btn-report" onclick="generateLaporan()">
                                        <i class="fas fa-file-pdf"></i> Generate Laporan dengan TTD
                                    </button>
                                    <button class="action-btn btn-pdf" onclick="window.open('data:text/json,' + encodeURIComponent(JSON.stringify(CONFIG.ABSENSI_DATA, null, 2)), '_blank')">
                                        <i class="fas fa-download"></i> Export Data JSON
                                    </button>
                                    <button class="action-btn btn-danger" onclick="if(confirm('Reset semua data?')) { localStorage.clear(); location.reload(); }">
                                        <i class="fas fa-trash"></i> Reset Data
                                    </button>
                                </div>
                                
                                <div style="margin-top: 20px; padding: 15px; background: #e8eaf6; border-radius: var(--border-radius);">
                                    <div style="display: flex; align-items: center; gap: 10px; color: var(--primary);">
                                        <i class="fas fa-info-circle"></i>
                                        <strong>Informasi Data:</strong>
                                    </div>
                                    <p style="margin-top: 10px; font-size: 14px; color: #555;">
                                        Data di halaman ini diperbarui secara otomatis setiap kali ada absensi baru.
                                        <br>Data tersimpan di localStorage browser Anda.
                                    </p>
                                </div>
                            </div>
                            
                            <div class="form-card">
                                <div class="form-header">
                                    <i class="fas fa-history"></i>
                                    <h3>Riwayat Lengkap</h3>
                                    <small style="margin-left: auto; color: var(--gray);">
                                        Total: ${CONFIG.ABSENSI_DATA.length} data
                                    </small>
                                </div>
                                
                                <div class="data-table-container">
                                    <table class="data-table" id="dataTableFull">
                                        <thead>
                                            <tr>
                                                <th>No</th>
                                                <th>Nama</th>
                                                <th>Divisi</th>
                                                <th>Kegiatan</th>
                                                <th>Tanggal</th>
                                                <th>Waktu</th>
                                                <th>Mode</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Data akan diisi oleh JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            `;

        initializeApp();
      }

      window.logout = function () {
        if (confirm("Keluar dari sistem?")) {
          localStorage.removeItem("irmas_auth");
          location.reload();
        }
      };
    </script>
  </body>
</html>
